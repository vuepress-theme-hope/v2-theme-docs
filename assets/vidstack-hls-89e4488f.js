import{at as m,j as l,au as w,av as f,ak as h,aw as p,l as v,e as E,ar as T,as as b,am as c,ax as L,ac as _,ay as X,az as S,i as $,aA as D}from"./vidstack-2eac4c2a-ddb176c6.js";import{VideoProvider as I}from"./vidstack-video-4e22bb89.js";import{R as C}from"./vidstack-afcf95d9-3b889411.js";import"./app-1ee6e138.js";const R=o=>D(o);class q{constructor(t){this.Xa=null,this.Ya=null,this.f={},this.g=new Set,this.Q=t}get instance(){return this.Xa}setup(t,i){this._=i;const e=f(i.$state.streamType).includes("live"),r=f(i.$state.streamType).includes("ll-");this.Xa=new t({lowLatencyMode:r,backBufferLength:r?4:e?8:void 0,renderTextTracksNatively:!1,...this.f});const s=this.Za.bind(this);for(const a of Object.values(t.Events))this.Xa.on(a,s);this.Xa.on(t.Events.ERROR,this.pa.bind(this));for(const a of this.g)a(this.Xa);i.player.dispatch(new h("hls-instance",{detail:this.Xa})),this.Xa.attachMedia(this.Q),this.Xa.on(t.Events.AUDIO_TRACK_SWITCHED,this._a.bind(this)),this.Xa.on(t.Events.LEVEL_SWITCHED,this.$a.bind(this)),this.Xa.on(t.Events.LEVEL_LOADED,this.ab.bind(this)),this.Xa.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.bb.bind(this)),this.Xa.on(t.Events.CUES_PARSED,this.cb.bind(this)),i.qualities[p.db]=this.eb.bind(this),v(i.qualities,"change",this.fb.bind(this)),v(i.audioTracks,"change",this.gb.bind(this)),this.Ya=E(this.hb.bind(this))}hb(){if(!this._.$state.live())return;const t=new C(this.ib.bind(this));return t.Oa(),t.ga.bind(t)}ib(){var t;this._.$state.liveSyncPosition.set(((t=this.Xa)==null?void 0:t.liveSyncPosition)??1/0)}Za(t,i){var e;(e=this._.player)==null||e.dispatch(new h(R(t),{detail:i}))}bb(t,i){const e=new h(t,{detail:i});let r=-1;for(let s=0;s<i.tracks.length;s++){const a=i.tracks[s],n=a.subtitleTrack??a.closedCaptions,u=new T({id:`hls-${a.kind}${s}`,src:n==null?void 0:n.url,label:a.label,language:n==null?void 0:n.lang,kind:a.kind});u[b.jb]=2,u[b.kb]=()=>{u.mode==="showing"?(this.Xa.subtitleTrack=s,r=s):r===s&&(this.Xa.subtitleTrack=-1,r=-1)},a.default&&u.setMode("showing",e),this._.textTracks.add(u,e)}}cb(t,i){const e=this._.textTracks.getById(`hls-${i.track}`);if(!e)return;const r=new h(t,{detail:i});for(const s of i.cues)s.positionAlign="auto",e.addCue(s,r)}_a(t,i){const e=this._.audioTracks[i.id];e&&this._.audioTracks[c.Wa](e,!0,new h(t,{detail:i}))}$a(t,i){const e=this._.qualities[i.level];e&&this._.qualities[c.Wa](e,!0,new h(t,{detail:i}))}ab(t,i){if(this._.$state.canPlay())return;const{type:e,live:r,totalduration:s,targetduration:a}=i.details,n=new h(t,{detail:i});this._.delegate.h("stream-type-change",{detail:r?e==="EVENT"&&Number.isFinite(s)&&a>=10?"live:dvr":"live":"on-demand",trigger:n}),this._.delegate.h("duration-change",{detail:s,trigger:n});const u=this.Xa.media;this.Xa.currentLevel===-1&&this._.qualities[p.lb](!0,n);for(const d of this.Xa.audioTracks)this._.audioTracks[c.r]({id:d.id+"",label:d.name,language:d.lang||"",kind:"main"},n);for(const d of this.Xa.levels)this._.qualities[c.r]({width:d.width,height:d.height,codec:d.codecSet,bitrate:d.bitrate},n);u.dispatchEvent(new h("canplay",{trigger:n}))}pa(t,i){var e,r,s;if(i.fatal)switch(i.type){case"networkError":(e=this.Xa)==null||e.startLoad();break;case"mediaError":(r=this.Xa)==null||r.recoverMediaError();break;default:(s=this.Xa)==null||s.destroy(),this.Xa=null;break}}eb(){this.Xa&&(this.Xa.currentLevel=-1)}fb(){const{qualities:t}=this._;!this.Xa||t.auto||(this.Xa[t.switch+"Level"]=t.selectedIndex,L&&(this.Q.currentTime=this.Q.currentTime))}gb(){const{audioTracks:t}=this._;this.Xa&&this.Xa.audioTrack!==t.selectedIndex&&(this.Xa.audioTrack=t.selectedIndex)}i(){var t,i;this._&&(this._.qualities[p.db]=void 0),(t=this.Xa)==null||t.destroy(),this.Xa=null,(i=this.Ya)==null||i.call(this),this.Ya=null}}class O{constructor(t,i,e){this.mb=t,this._=i,this.qb=e,this.nb()}async nb(){const t={onLoadStart:this.na.bind(this),onLoaded:this.ob.bind(this),onLoadError:this.pb.bind(this)};let i=await j(this.mb,t);if(_(i)&&!l(this.mb)&&(i=await H(this.mb,t)),!i)return null;if(!i.isSupported()){const e="[vidstack]: `hls.js` is not supported in this environment";return this._.player.dispatch(new h("hls-unsupported")),this._.delegate.h("error",{detail:{message:e,code:4}}),null}return i}na(){this._.player.dispatch(new h("hls-lib-load-start"))}ob(t){this._.player.dispatch(new h("hls-lib-loaded",{detail:t})),this.qb(t)}pb(t){const i=X(t);this._.player.dispatch(new h("hls-lib-load-error",{detail:i})),this._.delegate.h("error",{detail:{message:i.message,code:4}})}}async function H(o,t={}){var i,e,r,s,a;if(!_(o)){if((i=t.onLoadStart)==null||i.call(t),o.prototype&&o.prototype!==Function)return(e=t.onLoaded)==null||e.call(t,o),o;try{const n=(r=await o())==null?void 0:r.default;if(n&&n.isSupported)(s=t.onLoaded)==null||s.call(t,n);else throw Error("");return n}catch(n){(a=t.onLoadError)==null||a.call(t,n)}}}async function j(o,t={}){var i,e,r;if(l(o)){(i=t.onLoadStart)==null||i.call(t);try{if(await S(o),!$(window.Hls))throw Error("");const s=window.Hls;return(e=t.onLoaded)==null||e.call(t,s),s}catch(s){(r=t.onLoadError)==null||r.call(t,s)}}}const A="https://cdn.jsdelivr.net",g=class g extends I{constructor(){super(...arguments),this.$$PROVIDER_TYPE="HLS",this.e=null,this.c=new q(this.video),this.d=`${A}/npm/hls.js@^1.0.0/dist/hls.min.js`}get ctor(){return this.e}get instance(){return this.c.instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.c.f}set config(t){this.c.f=t}get library(){return this.d}set library(t){this.d=t}preconnect(){l(this.d)&&w(this.d)}setup(t){super.setup(t),new O(this.d,t,i=>{this.e=i,this.c.setup(i,t),t.delegate.h("provider-setup",{detail:this});const e=f(t.$state.source);e&&this.loadSource(e)})}async loadSource(t,i){var e;l(t.src)&&(this.a.preload=i||"",(e=this.c.instance)==null||e.loadSource(t.src),this.b=t)}onInstance(t){const i=this.c.instance;return i&&t(i),this.c.g.add(t),()=>this.c.g.delete(t)}destroy(){this.c.i()}};g.supported=m();let y=g;export{y as HLSProvider};
