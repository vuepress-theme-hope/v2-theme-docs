import{an as b,ao as h,ap as o,aq as p,o as d,ar as g,as as n,l as c,ak as P}from"./vidstack-2eac4c2a-ddb176c6.js";import{H as f}from"./vidstack-afcf95d9-3b889411.js";import"./app-1ee6e138.js";class k{constructor(t,e){this.Q=t,this.Pa=e,t.textTracks.onaddtrack=this.rb.bind(this),d(this.ma.bind(this))}rb(t){const e=t.track;if(!e||x(this.Q,e))return;const i=new g({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[n.sb]={track:e},i[n.jb]=2,i[n.tb]=!0;let r=0;const u=l=>{if(e.cues)for(let a=r;a<e.cues.length;a++)i.addCue(e.cues[a],l),r++};u(t),e.oncuechange=u,this.Pa.textTracks.add(i,t),i.setMode(e.mode,t)}ma(){var t;this.Q.textTracks.onaddtrack=null;for(const e of this.Pa.textTracks){const i=(t=e[n.sb])==null?void 0:t.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function x(s,t){return Array.from(s.children).find(e=>e.track===t)}class y{constructor(t,e){this.ub=(i,r)=>{this.a.delegate.h("picture-in-picture-change",{detail:i,trigger:r})},this.Q=t,this.a=e,c(this.Q,"enterpictureinpicture",this.vb.bind(this)),c(this.Q,"leavepictureinpicture",this.wb.bind(this))}get active(){return document.pictureInPictureElement===this.Q}get supported(){return o(this.Q)}async enter(){return this.Q.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}vb(t){this.ub(!0,t)}wb(t){this.ub(!1,t)}}class v{constructor(t,e){this.xb="inline",this.Q=t,this.a=e,c(this.Q,"webkitpresentationmodechanged",this.kb.bind(this))}get Ab(){return h(this.Q)}async zb(t){this.xb!==t&&this.Q.webkitSetPresentationMode(t)}kb(){var e;const t=this.xb;this.xb=this.Q.webkitPresentationMode,(e=this.a.player)==null||e.dispatch(new P("video-presentation-change",{detail:this.xb,trigger:event})),["fullscreen","picture-in-picture"].forEach(i=>{(this.xb===i||t===i)&&this.a.delegate.h(`${i}-change`,{detail:this.xb===i,trigger:event})})}}class m{constructor(t){this.yb=t}get active(){return this.yb.xb==="fullscreen"}get supported(){return this.yb.Ab}async enter(){this.yb.zb("fullscreen")}async exit(){this.yb.zb("inline")}}class Q{constructor(t){this.yb=t}get active(){return this.yb.xb==="picture-in-picture"}get supported(){return this.yb.Ab}async enter(){this.yb.zb("picture-in-picture")}async exit(){this.yb.zb("inline")}}class E extends f{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",b(()=>{if(h(t)){const i=new v(t,e);this.fullscreen=new m(i),this.pictureInPicture=new Q(i)}else o(t)&&(this.pictureInPicture=new y(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),p(this.video)&&new k(this.video,t),t.textRenderers.j(this.video),d(()=>{t.textRenderers.j(null)}),this.type==="video"&&t.delegate.h("provider-setup",{detail:this})}get video(){return this.a}}export{E as VideoProvider};
