import{ac as d,ad as o,ae as c,o as l,s as g,af as m,j as f,ag as p,e as b,l as r,ah as y,ai as k,aj as n,ak as u,al as T,am as h}from"./vidstack-2eac4c2a-ddb176c6.js";class Y{constructor(t){this.qb=t}Oa(){d(this.Cd)&&this.yh()}ga(){o(this.Cd)&&window.cancelAnimationFrame(this.Cd),this.Cd=void 0}yh(){this.Cd=window.requestAnimationFrame(()=>{d(this.Cd)||(this.qb(),this.yh())})}}class Z{constructor(t,a){this.V=p(),this.aa=!1,this.ca=!1,this.da=!1,this.ba=new Y(this.ja.bind(this)),this.ia=void 0,this.Ja=void 0,this.ea=t,this._=a,this.ka(),b(this.la.bind(this)),l(this.ma.bind(this))}get a(){return this.ea.media}get Y(){return this._.delegate}ma(){this.ca=!1,this.da=!1,this.ba.ga(),this.V.empty()}ja(){const t=this.ea.currentTime;this._.$state.currentTime()!==t&&this.$(t)}ka(){this.Z("loadstart",this.na),this.Z("abort",this.ha),this.Z("emptied",this.oa),this.Z("error",this.pa)}qa(){this.ca||(this.V.add(this.Z("loadeddata",this.ra),this.Z("loadedmetadata",this.sa),this.Z("canplay",this.ta),this.Z("canplaythrough",this.ua),this.Z("durationchange",this.va),this.Z("play",this.wa),this.Z("progress",this.xa),this.Z("stalled",this.ya),this.Z("suspend",this.za)),this.ca=!0)}Aa(){this.da||(this.V.add(this.Z("pause",this.Ba),this.Z("playing",this.Ca),this.Z("ratechange",this.Da),this.Z("seeked",this.Ea),this.Z("seeking",this.Fa),this.Z("ended",this.Ga),this.Z("volumechange",this.Ha),this.Z("waiting",this.Ia)),this.da=!0)}Z(t,a){return r(this.a,t,a.bind(this))}Ka(t){}$(t,a){this.Y.h("time-update",{detail:{currentTime:Math.min(t,this._.$state.seekableEnd()),played:this.a.played},trigger:a})}na(t){if(this.a.networkState===3){this.ha(t);return}this.qa(),this.Y.h("load-start",{trigger:t})}ha(t){this.Y.h("abort",{trigger:t})}oa(){this.Y.h("emptied",{trigger:event})}ra(t){this.Y.h("loaded-data",{trigger:t})}sa(t){this.Aa(),this.Y.h("volume-change",{detail:{volume:this.a.volume,muted:this.a.muted}}),this.Y.h("loaded-metadata",{trigger:t}),y&&k(this._.$state.source())&&this.Y.La(this.fa(),t)}fa(){return{duration:this.a.duration,buffered:this.a.buffered,seekable:this.a.seekable}}wa(t){this._.$state.canPlay&&this.Y.h("play",{trigger:t})}Ba(t){this.a.readyState===1&&!this.aa||(this.aa=!1,this.ba.ga(),this.Y.h("pause",{trigger:t}))}ta(t){this.Y.La(this.fa(),t)}ua(t){this._.$state.started()||this.Y.h("can-play-through",{trigger:t,detail:this.fa()})}Ca(t){this.aa=!1,this.Y.h("playing",{trigger:t}),this.ba.Oa()}ya(t){this.Y.h("stalled",{trigger:t}),this.a.readyState<3&&(this.aa=!0,this.Y.h("waiting",{trigger:t}))}Ia(t){this.a.readyState<3&&(this.aa=!0,this.Y.h("waiting",{trigger:t}))}Ga(t){this.ba.ga(),this.$(this.a.duration,t),this.Y.h("end",{trigger:t}),this._.$state.loop()?this.Ma():this.Y.h("ended",{trigger:t})}la(){this._.$state.paused()&&r(this.a,"timeupdate",this.Na.bind(this))}Na(t){this.$(this.a.currentTime,t)}va(t){this._.$state.ended()&&this.$(this.a.duration,t),this.Y.h("duration-change",{detail:this.a.duration,trigger:t})}Ha(t){this.Y.h("volume-change",{detail:{volume:this.a.volume,muted:this.a.muted},trigger:t})}Ea(t){this.$(this.a.currentTime,t),this.Y.h("seeked",{detail:this.a.currentTime,trigger:t}),Math.trunc(this.a.currentTime)===Math.trunc(this.a.duration)&&n(this.a.duration)>n(this.a.currentTime)&&(this.$(this.a.duration,t),this.a.ended||this._.player.dispatch(new u("media-play-request",{trigger:t})))}Fa(t){this.Y.h("seeking",{detail:this.a.currentTime,trigger:t})}xa(t){this.Y.h("progress",{detail:{buffered:this.a.buffered,seekable:this.a.seekable},trigger:t})}Ma(){T(this.a.controls)&&(this.a.controls=!1),this._.player.dispatch(new u("media-loop-request"))}za(t){this.Y.h("suspend",{trigger:t})}Da(t){this.Y.h("rate-change",{detail:this.a.playbackRate,trigger:t})}pa(t){const a=this.a.error;a&&this.Y.h("error",{detail:{message:a.message,code:a.code,mediaError:a},trigger:t})}}class w{constructor(t,a){this.ea=t,this.Pa=a,this.Qa.onaddtrack=this.Sa.bind(this),this.Qa.onremovetrack=this.Ta.bind(this),this.Qa.onchange=this.Ua.bind(this),r(this.Pa.audioTracks,"change",this.Va.bind(this))}get Qa(){return this.ea.media.audioTracks}Sa(t){const a=t.track;if(a.label==="")return;const i={id:a.id+"",label:a.label,language:a.language,kind:a.kind,selected:!1};this.Pa.audioTracks[h.r](i,t),a.enabled&&(i.selected=!0)}Ta(t){const a=this.Pa.audioTracks.getById(t.track.id);a&&this.Pa.audioTracks[h.p](a,t)}Ua(t){let a=this.Ra();if(!a)return;const i=this.Pa.audioTracks.getById(a.id);i&&this.Pa.audioTracks[h.Wa](i,!0,t)}Ra(){return Array.from(this.Qa).find(t=>t.enabled)}Va(t){const{current:a}=t.detail;if(!a)return;const i=this.Qa.getTrackById(a.id);if(i){const s=this.Ra();s&&(s.enabled=!1),i.enabled=!0}}}class S{constructor(t){this.scope=c(),this.b=null,this.a=t}setup(t){new Z(this,t),"audioTracks"in this.media&&new w(this,t);const{muted:a,volume:i,playsinline:s}=t.$state;this.muted=a(),this.volume=i(),this.playsinline=s(),l(()=>{this.a.setAttribute("src",""),this.a.load()})}get type(){return""}get media(){return this.a}get currentSrc(){return this.b}get paused(){return this.a.paused}get muted(){return this.a.muted}set muted(t){this.a.muted=t}get volume(){return this.a.volume}set volume(t){this.a.volume=t}get currentTime(){return this.a.currentTime}set currentTime(t){this.a.currentTime=t}get playsinline(){return this.a.hasAttribute("playsinline")}set playsinline(t){g(this.a,"playsinline",t)}get playbackRate(){return this.a.playbackRate}set playbackRate(t){this.a.playbackRate=t}async play(){return this.a.play()}async pause(){return this.a.pause()}async loadSource({src:t,type:a},i){this.a.preload=i||"",m(t)?this.a.srcObject=t:(this.a.srcObject=null,this.a.src=f(t)?t:window.URL.createObjectURL(t)),this.a.load(),this.b={src:t,type:a}}}export{S as H,Y as R};
