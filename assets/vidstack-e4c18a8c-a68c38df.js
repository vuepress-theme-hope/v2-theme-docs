import{ac as g,ad as f,ae as u,o as c,s as l,af as o,j as m,ag as p,e as b,l as r,ah as y,ai as w,aj as n,ak as d,al as k,am as h}from"./vidstack-725a7f4d-95ea9c0b.js";class T{constructor(t){this.Xg=t}Nb(){g(this.gc)&&this.Fj()}Ob(){f(this.gc)&&window.cancelAnimationFrame(this.gc),this.gc=void 0}Fj(){this.gc=window.requestAnimationFrame(()=>{g(this.gc)||(this.Xg(),this.Fj())})}}class H{constructor(t,i){this.Nf=p(),this.Tf=!1,this.Vf=!1,this.Wf=!1,this.Uf=new T(this._f.bind(this)),this.Zf=void 0,this.sg=void 0,this.mb=t,this.Rf=i,this.$f(),b(this.ag.bind(this)),c(this.bg.bind(this))}get t(){return this.mb.media}get Hc(){return this.Rf.delegate}bg(){this.Vf=!1,this.Wf=!1,this.Uf.Ob(),this.Nf.empty()}_f(){const t=this.mb.currentTime;this.Rf.$state.currentTime()!==t&&this.Sf(t)}$f(){this.Qf("loadstart",this.tf),this.Qf("abort",this.Yf),this.Qf("emptied",this.cg),this.Qf("error",this._c)}dg(){this.Vf||(this.Nf.add(this.Qf("loadeddata",this.eg),this.Qf("loadedmetadata",this.fg),this.Qf("canplay",this.Tc),this.Qf("canplaythrough",this.gg),this.Qf("durationchange",this.hg),this.Qf("play",this.ea),this.Qf("progress",this.ig),this.Qf("stalled",this.jg),this.Qf("suspend",this.kg)),this.Vf=!0)}lg(){this.Wf||(this.Nf.add(this.Qf("pause",this.fa),this.Qf("playing",this.mg),this.Qf("ratechange",this.ng),this.Qf("seeked",this.og),this.Qf("seeking",this.pg),this.Qf("ended",this.qg),this.Qf("volumechange",this.fd),this.Qf("waiting",this.rg)),this.Wf=!0)}Qf(t,i){return r(this.t,t,i.bind(this))}tg(t){}Sf(t,i){this.Hc.w("time-update",{detail:{currentTime:Math.min(t,this.Rf.$state.seekableEnd()),played:this.t.played},trigger:i})}tf(t){if(this.t.networkState===3){this.Yf(t);return}this.dg(),this.Hc.w("load-start",{trigger:t})}Yf(t){this.Hc.w("abort",{trigger:t})}cg(){this.Hc.w("emptied",{trigger:event})}eg(t){this.Hc.w("loaded-data",{trigger:t})}fg(t){this.lg(),this.Hc.w("volume-change",{detail:{volume:this.t.volume,muted:this.t.muted}}),this.Hc.w("loaded-metadata",{trigger:t}),y&&w(this.Rf.$state.source())&&this.Hc.ug(this.Xf(),t)}Xf(){return{duration:this.t.duration,buffered:this.t.buffered,seekable:this.t.seekable}}ea(t){this.Rf.$state.canPlay&&this.Hc.w("play",{trigger:t})}fa(t){this.t.readyState===1&&!this.Tf||(this.Tf=!1,this.Uf.Ob(),this.Hc.w("pause",{trigger:t}))}Tc(t){this.Hc.ug(this.Xf(),t)}gg(t){this.Rf.$state.started()||this.Hc.w("can-play-through",{trigger:t,detail:this.Xf()})}mg(t){this.Tf=!1,this.Hc.w("playing",{trigger:t}),this.Uf.Nb()}jg(t){this.Hc.w("stalled",{trigger:t}),this.t.readyState<3&&(this.Tf=!0,this.Hc.w("waiting",{trigger:t}))}rg(t){this.t.readyState<3&&(this.Tf=!0,this.Hc.w("waiting",{trigger:t}))}qg(t){this.Uf.Ob(),this.Sf(this.t.duration,t),this.Hc.w("end",{trigger:t}),this.Rf.$state.loop()?this.vg():this.Hc.w("ended",{trigger:t})}ag(){this.Rf.$state.paused()&&r(this.t,"timeupdate",this.wg.bind(this))}wg(t){this.Sf(this.t.currentTime,t)}hg(t){this.Rf.$state.ended()&&this.Sf(this.t.duration,t),this.Hc.w("duration-change",{detail:this.t.duration,trigger:t})}fd(t){this.Hc.w("volume-change",{detail:{volume:this.t.volume,muted:this.t.muted},trigger:t})}og(t){this.Sf(this.t.currentTime,t),this.Hc.w("seeked",{detail:this.t.currentTime,trigger:t}),Math.trunc(this.t.currentTime)===Math.trunc(this.t.duration)&&n(this.t.duration)>n(this.t.currentTime)&&(this.Sf(this.t.duration,t),this.t.ended||this.Rf.player.dispatch(new d("media-play-request",{trigger:t})))}pg(t){this.Hc.w("seeking",{detail:this.t.currentTime,trigger:t})}ig(t){this.Hc.w("progress",{detail:{buffered:this.t.buffered,seekable:this.t.seekable},trigger:t})}vg(){k(this.t.controls)&&(this.t.controls=!1),this.Rf.player.dispatch(new d("media-loop-request"))}kg(t){this.Hc.w("suspend",{trigger:t})}ng(t){this.Hc.w("rate-change",{detail:this.t.playbackRate,trigger:t})}_c(t){const i=this.t.error;i&&this.Hc.w("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class R{constructor(t,i){this.mb=t,this.xg=i,this.yg.onaddtrack=this.Ag.bind(this),this.yg.onremovetrack=this.Bg.bind(this),this.yg.onchange=this.Cg.bind(this),r(this.xg.audioTracks,"change",this.Dg.bind(this))}get yg(){return this.mb.media.audioTracks}Ag(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.xg.audioTracks[h.h](s,t),i.enabled&&(s.selected=!0)}Bg(t){const i=this.xg.audioTracks.getById(t.track.id);i&&this.xg.audioTracks[h.f](i,t)}Cg(t){let i=this.zg();if(!i)return;const s=this.xg.audioTracks.getById(i.id);s&&this.xg.audioTracks[h.R](s,!0,t)}zg(){return Array.from(this.yg).find(t=>t.enabled)}Dg(t){const{current:i}=t.detail;if(!i)return;const s=this.yg.getTrackById(i.id);if(s){const e=this.zg();e&&(e.enabled=!1),s.enabled=!0}}}class S{constructor(t){this.scope=u(),this.u=null,this.t=t}setup(t){new H(this,t),"audioTracks"in this.media&&new R(this,t);const{muted:i,volume:s,playsinline:e}=t.$state;this.muted=i(),this.volume=s(),this.playsinline=e(),c(()=>{this.t.setAttribute("src",""),this.t.load()})}get type(){return""}get media(){return this.t}get currentSrc(){return this.u}get paused(){return this.t.paused}get muted(){return this.t.muted}set muted(t){this.t.muted=t}get volume(){return this.t.volume}set volume(t){this.t.volume=t}get currentTime(){return this.t.currentTime}set currentTime(t){this.t.currentTime=t}get playsinline(){return this.t.hasAttribute("playsinline")}set playsinline(t){l(this.t,"playsinline",t)}get playbackRate(){return this.t.playbackRate}set playbackRate(t){this.t.playbackRate=t}async play(){return this.t.play()}async pause(){return this.t.pause()}async loadSource({src:t,type:i},s){this.t.preload=s||"",o(t)?this.t.srcObject=t:(this.t.srcObject=null,this.t.src=m(t)?t:window.URL.createObjectURL(t)),this.t.load(),this.u={src:t,type:i}}}export{S as H,T as R};
