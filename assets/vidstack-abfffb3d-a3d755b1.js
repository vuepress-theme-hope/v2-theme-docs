import{ac as d,ad as l,ae as o,o as u,s as c,af as b,j as f,ag as m,e as p,l as h,ah as y,ai as k,aj as n,ak as g,al as T,am as e}from"./vidstack-1a42d66e-f4a5b7c4.js";class L{constructor(t){this.sa=t}ia(){d(this.de)&&this.yh()}ja(){l(this.de)&&window.cancelAnimationFrame(this.de),this.de=void 0}yh(){this.de=window.requestAnimationFrame(()=>{d(this.de)||(this.sa(),this.yh())})}}class K{constructor(t,i){this.va=m(),this.Na=!1,this.Pa=!1,this.Qa=!1,this.Oa=new L(this.Va.bind(this)),this.Ua=void 0,this.qb=void 0,this.Ra=t,this.U=i,this.Wa(),p(this.Xa.bind(this)),u(this.Aa.bind(this))}get g(){return this.Ra.media}get Ka(){return this.U.delegate}Aa(){this.Pa=!1,this.Qa=!1,this.Oa.ja(),this.va.empty()}Va(){const t=this.Ra.currentTime;this.U.$state.currentTime()!==t&&this.Ma(t)}Wa(){this.La("loadstart",this.pa),this.La("abort",this.Ta),this.La("emptied",this.Ya),this.La("error",this.X)}Za(){this.Pa||(this.va.add(this.La("loadeddata",this._a),this.La("loadedmetadata",this.$a),this.La("canplay",this.ab),this.La("canplaythrough",this.bb),this.La("durationchange",this.cb),this.La("play",this.db),this.La("progress",this.eb),this.La("stalled",this.fb),this.La("suspend",this.gb)),this.Pa=!0)}hb(){this.Qa||(this.va.add(this.La("pause",this.ib),this.La("playing",this.jb),this.La("ratechange",this.kb),this.La("seeked",this.lb),this.La("seeking",this.mb),this.La("ended",this.nb),this.La("volumechange",this.ob),this.La("waiting",this.pb)),this.Qa=!0)}La(t,i){return h(this.g,t,i.bind(this))}rb(t){}Ma(t,i){this.Ka.f("time-update",{detail:{currentTime:Math.min(t,this.U.$state.seekableEnd()),played:this.g.played},trigger:i})}pa(t){if(this.g.networkState===3){this.Ta(t);return}this.Za(),this.Ka.f("load-start",{trigger:t})}Ta(t){this.Ka.f("abort",{trigger:t})}Ya(){this.Ka.f("emptied",{trigger:event})}_a(t){this.Ka.f("loaded-data",{trigger:t})}$a(t){this.hb(),this.Ka.f("volume-change",{detail:{volume:this.g.volume,muted:this.g.muted}}),this.Ka.f("loaded-metadata",{trigger:t}),y&&k(this.U.$state.source())&&this.Ka.sb(this.Sa(),t)}Sa(){return{duration:this.g.duration,buffered:this.g.buffered,seekable:this.g.seekable}}db(t){this.U.$state.canPlay&&this.Ka.f("play",{trigger:t})}ib(t){this.g.readyState===1&&!this.Na||(this.Na=!1,this.Oa.ja(),this.Ka.f("pause",{trigger:t}))}ab(t){this.Ka.sb(this.Sa(),t)}bb(t){this.U.$state.started()||this.Ka.f("can-play-through",{trigger:t,detail:this.Sa()})}jb(t){this.Na=!1,this.Ka.f("playing",{trigger:t}),this.Oa.ia()}fb(t){this.Ka.f("stalled",{trigger:t}),this.g.readyState<3&&(this.Na=!0,this.Ka.f("waiting",{trigger:t}))}pb(t){this.g.readyState<3&&(this.Na=!0,this.Ka.f("waiting",{trigger:t}))}nb(t){this.Oa.ja(),this.Ma(this.g.duration,t),this.Ka.f("end",{trigger:t}),this.U.$state.loop()?this.tb():this.Ka.f("ended",{trigger:t})}Xa(){this.U.$state.paused()&&h(this.g,"timeupdate",this.ub.bind(this))}ub(t){this.Ma(this.g.currentTime,t)}cb(t){this.U.$state.ended()&&this.Ma(this.g.duration,t),this.Ka.f("duration-change",{detail:this.g.duration,trigger:t})}ob(t){this.Ka.f("volume-change",{detail:{volume:this.g.volume,muted:this.g.muted},trigger:t})}lb(t){this.Ma(this.g.currentTime,t),this.Ka.f("seeked",{detail:this.g.currentTime,trigger:t}),Math.trunc(this.g.currentTime)===Math.trunc(this.g.duration)&&n(this.g.duration)>n(this.g.currentTime)&&(this.Ma(this.g.duration,t),this.g.ended||this.U.player.dispatch(new g("media-play-request",{trigger:t})))}mb(t){this.Ka.f("seeking",{detail:this.g.currentTime,trigger:t})}eb(t){this.Ka.f("progress",{detail:{buffered:this.g.buffered,seekable:this.g.seekable},trigger:t})}tb(){T(this.g.controls)&&(this.g.controls=!1),this.U.player.dispatch(new g("media-loop-request"))}gb(t){this.Ka.f("suspend",{trigger:t})}kb(t){this.Ka.f("rate-change",{detail:this.g.playbackRate,trigger:t})}X(t){const i=this.g.error;i&&this.Ka.f("error",{detail:{message:i.message,code:i.code,mediaError:i},trigger:t})}}class v{constructor(t,i){this.Ra=t,this.ya=i,this.vb.onaddtrack=this.xb.bind(this),this.vb.onremovetrack=this.yb.bind(this),this.vb.onchange=this.zb.bind(this),h(this.ya.audioTracks,"change",this.Ab.bind(this))}get vb(){return this.Ra.media.audioTracks}xb(t){const i=t.track;if(i.label==="")return;const a={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.ya.audioTracks[e.F](a,t),i.enabled&&(a.selected=!0)}yb(t){const i=this.ya.audioTracks.getById(t.track.id);i&&this.ya.audioTracks[e.D](i,t)}zb(t){let i=this.wb();if(!i)return;const a=this.ya.audioTracks.getById(i.id);a&&this.ya.audioTracks[e.ha](a,!0,t)}wb(){return Array.from(this.vb).find(t=>t.enabled)}Ab(t){const{current:i}=t.detail;if(!i)return;const a=this.vb.getTrackById(i.id);if(a){const r=this.wb();r&&(r.enabled=!1),a.enabled=!0}}}class S{constructor(t){this.scope=o(),this.h=null,this.g=t}setup(t){new K(this,t),"audioTracks"in this.media&&new v(this,t),u(()=>{this.g.setAttribute("src",""),this.g.load()})}get type(){return""}get media(){return this.g}get currentSrc(){return this.h}get paused(){return this.g.paused}get muted(){return this.g.muted}set muted(t){this.g.muted=t}get volume(){return this.g.volume}set volume(t){this.g.volume=t}get currentTime(){return this.g.currentTime}set currentTime(t){this.g.currentTime=t}get playsinline(){return this.g.hasAttribute("playsinline")}set playsinline(t){c(this.g,"playsinline",t)}get playbackRate(){return this.g.playbackRate}set playbackRate(t){this.g.playbackRate=t}async play(){return this.g.play()}async pause(){return this.g.pause()}async loadSource({src:t,type:i},a){this.g.preload=a||"",b(t)?this.g.srcObject=t:(this.g.srcObject=null,this.g.src=f(t)?t:window.URL.createObjectURL(t)),this.g.load(),this.h={src:t,type:i}}}export{S as H,L as R};
