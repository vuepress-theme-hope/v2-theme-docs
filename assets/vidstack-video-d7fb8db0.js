import{an as p,ao as h,ap as o,aq as g,o as d,ar as v,as as r,l as c,ak as f}from"./vidstack-1a42d66e-f4a5b7c4.js";import{H as P}from"./vidstack-abfffb3d-a3d755b1.js";import"./app-a080876e.js";class k{constructor(t,e){this.v=t,this.ya=e,t.textTracks.onaddtrack=this.za.bind(this),d(this.Aa.bind(this))}za(t){const e=t.track;if(!e||I(this.v,e))return;const i=new v({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[r.Ba]={track:e},i[r.ka]=2,i[r.Ca]=!0;let a=0;const u=l=>{if(e.cues)for(let n=a;n<e.cues.length;n++)i.addCue(e.cues[n],l),a++};u(t),e.oncuechange=u,this.ya.textTracks.add(i,t),i.setMode(e.mode,t)}Aa(){var t;this.v.textTracks.onaddtrack=null;for(const e of this.ya.textTracks){const i=(t=e[r.Ba])==null?void 0:t.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function I(s,t){return Array.from(s.children).find(e=>e.track===t)}class y{constructor(t,e){this.Da=(i,a)=>{this.g.delegate.f("picture-in-picture-change",{detail:i,trigger:a})},this.v=t,this.g=e,c(this.v,"enterpictureinpicture",this.Ea.bind(this)),c(this.v,"leavepictureinpicture",this.Fa.bind(this))}get active(){return document.pictureInPictureElement===this.v}get supported(){return o(this.v)}async enter(){return this.v.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}Ea(t){this.Da(!0,t)}Fa(t){this.Da(!1,t)}}class H{constructor(t,e){this.Ga="inline",this.v=t,this.g=e,c(this.v,"webkitpresentationmodechanged",this.la.bind(this))}get Ja(){return h(this.v)}async Ia(t){this.Ga!==t&&this.v.webkitSetPresentationMode(t)}la(){var e;const t=this.Ga;this.Ga=this.v.webkitPresentationMode,(e=this.g.player)==null||e.dispatch(new f("video-presentation-change",{detail:this.Ga,trigger:event})),["fullscreen","picture-in-picture"].forEach(i=>{(this.Ga===i||t===i)&&this.g.delegate.f(`${i}-change`,{detail:this.Ga===i,trigger:event})})}}class T{constructor(t){this.Ha=t}get active(){return this.Ha.Ga==="fullscreen"}get supported(){return this.Ha.Ja}async enter(){this.Ha.Ia("fullscreen")}async exit(){this.Ha.Ia("inline")}}class m{constructor(t){this.Ha=t}get active(){return this.Ha.Ga==="picture-in-picture"}get supported(){return this.Ha.Ja}async enter(){this.Ha.Ia("picture-in-picture")}async exit(){this.Ha.Ia("inline")}}class E extends P{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",p(()=>{if(h(t)){const i=new H(t,e);this.fullscreen=new T(i),this.pictureInPicture=new m(i)}else o(t)&&(this.pictureInPicture=new y(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),g(this.video)&&new k(this.video,t),t.textRenderers.j(this.video),d(()=>{t.textRenderers.j(null)}),this.type==="video"&&t.delegate.f("provider-setup",{detail:this})}get video(){return this.g}}export{E as VideoProvider};
